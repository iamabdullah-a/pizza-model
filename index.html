<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Enterprise Marker AR â€” Stable</title>

<!-- A-Frame + MindAR -->
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
html, body {
  margin: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: black;
}

/* Fullscreen camera */
a-scene, canvas, video {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
}

video {
  object-fit: cover;
}
</style>
</head>

<body>

<a-scene
  mindar-image="imageTargetSrc: assets/targets.mind; autoStart: true;"
  renderer="alpha: true; antialias: true;"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false">

  <a-assets>
    <a-asset-item id="model" src="assets/model.glb"></a-asset-item>
  </a-assets>

  <!-- Camera controlled by MindAR -->
  <a-camera position="0 0 0" look-controls="enabled:false"></a-camera>

  <!-- Marker anchor -->
  <a-entity mindar-image-target="targetIndex: 0">

    <!-- MODEL (this is what we smooth) -->
    <a-gltf-model
      id="modelEntity"
      src="#model"
      scale="0.8 0.8 0.8"
      rotation="0 180 0"
      visible="false">
    </a-gltf-model>

    <!-- Lighting -->
    <a-light type="ambient" intensity="0.9"></a-light>
    <a-light type="directional" intensity="1.2" position="1 2 1"></a-light>

  </a-entity>
</a-scene>

<script>
AFRAME.registerComponent("smooth-follow", {
  schema: { factor: { default: 0.25 } },

  init() {
    this.pos = new THREE.Vector3();
    this.quat = new THREE.Quaternion();
  },

  tick() {
    const parent = this.el.object3D.parent;
    if (!parent) return;

    this.pos.lerp(parent.position, this.data.factor);
    this.quat.slerp(parent.quaternion, this.data.factor);

    this.el.object3D.position.copy(this.pos);
    this.el.object3D.quaternion.copy(this.quat);
  }
});

const model = document.querySelector("#modelEntity");
const anchor = model.parentElement;

anchor.addEventListener("targetFound", () => {
  model.setAttribute("visible", true);
  model.setAttribute("smooth-follow", "");
});

anchor.addEventListener("targetLost", () => {
  model.setAttribute("visible", false);
});
</script>

</body>
</html>
